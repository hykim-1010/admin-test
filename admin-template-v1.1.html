<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>관리자 템플릿 v1.1</title>
  <style>
    :root {
      --gray-50: #f7f7f8; --gray-100: #eef0f3; --gray-200: #e1e4e8; --gray-300: #cfd6dd; --gray-400: #b6bec8;
      --text-strong: #1b2430; --text: #2f3a4a; --primary: #2a7de1; --primary-dark: #1d5fb0; --danger:#e53935;
    }
    html, body { height: 100%; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; color: var(--text); line-height: 1.45; font-size: 15px; }
    .container { padding: 12px 16px 20px; position: relative; }

    /* Meta */
    .meta { display: grid; grid-template-columns: 240px 64px 1fr 70px 200px 110px 70px 52px 40px; gap: 6px; align-items: stretch; border: 1px solid var(--gray-300); background: var(--gray-50); padding: 6px; border-radius: 6px; width: 100%; box-sizing: border-box; }
    .meta-title { background: #fff; border: 1px solid var(--gray-300); padding: 6px 8px; font-weight: 700; display: flex; align-items: center; }
    .meta-chip { background: #6f7785; color: #fff; font-weight: 700; display: flex; align-items: center; justify-content: center; padding: 0 10px; border-radius: 2px; }
    .meta-value { background: #fff; border: 1px solid var(--gray-300); padding: 6px 8px; display: flex; align-items: center; }
    .meta-chip.small { padding: 0 6px; }
    .meta-value.small { justify-content: center; }

    /* Title & Tabs */
    .section-title { display:flex; align-items:center; justify-content:space-between; margin: 16px 0 12px; font-size: 20px; font-weight: 800; }
    .tabbar { display: flex; gap: 8px; margin: 12px 0; }
    .tab-btn { height: 34px; padding: 0 14px; border: 1px solid var(--gray-300); border-radius: 6px; background: #fff; cursor: pointer; font-size: 14px; }
    .tab-btn.active { background: var(--text-strong); color: #fff; border-color: #191f28; }
    .panel { display: none; }
    .panel.active { display: block; }

    /* Layout */
    .layout { display: grid; grid-template-columns: 1fr 300px; gap: 16px; align-items: start; }
    .card { border: 1px solid var(--gray-300); border-radius: 6px; background: #fff; padding: 12px; width: 100%; max-width: 100%; overflow: hidden; box-sizing: border-box; }

    /* Filters */
    .filters { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .select, .input, .button { height: 32px; border: 1px solid var(--gray-300); border-radius: 6px; background: #fff; padding: 0 10px; font-size: 14px; max-width: 100%; box-sizing: border-box; }
    .button.primary { background: var(--text-strong); color: #fff; border-color: #191f28; cursor: pointer; font-size: 14px; height: 34px; padding: 0 14px; }
    .nav { display:flex; gap:6px; }

    /* Table */
    table { width: 100%; max-width: 100%; border-collapse: collapse; box-sizing: border-box; }
    thead th { text-align: left; font-size: 14px; color: #5b6676; font-weight: 700; border-top: 2px solid var(--gray-400); border-bottom: 1px solid var(--gray-300); padding: 10px 8px; background: #fafbfc; }
    tbody td { border-bottom: 1px solid var(--gray-200); padding: 10px 8px; font-size: 14px; }
    a.link { color: var(--primary); text-decoration: none; }

    /* Actions */
    .actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
    .btn-register { background: var(--primary); border: 1px solid var(--primary); color: #fff; padding: 8px 18px; border-radius: 6px; cursor: pointer; font-size: 14px; height: 34px; }
    .pagination { display: flex; gap: 4px; }
    .page-btn { min-width: 32px; height: 32px; border: 1px solid var(--gray-300); border-radius: 6px; background: #fff; text-align: center; line-height: 30px; cursor: pointer; padding: 0 8px; font-size: 14px; }

    /* Aside */
    .aside .title { font-weight: 800; margin-bottom: 8px; }
    .desc-list { border-top: 2px solid var(--gray-400); }
    .desc-item { border-bottom: 1px solid var(--gray-300); padding: 10px 8px; }
    .desc-item .head { font-weight: 700; margin-bottom: 6px; }

    /* Form (등록 탭) */
    .form { display: grid; gap: 12px; max-width: 100%; }
    .row { display: grid; grid-template-columns: 160px 1fr; gap: 12px; align-items: center; border-bottom: 1px solid var(--gray-200); padding-bottom: 10px; }
    .row:last-of-type { border-bottom: 0; }
    .row .label { font-weight: 700; color: #3a4556; display: flex; gap: 8px; align-items: center; }
    .row .req { color: #e53935; font-weight: 900; }
    .textarea { height: 120px; padding: 10px; resize: vertical; }
    .w-575 { width: 575px; max-width: 575px; box-sizing: border-box; }
    .filebox { display: grid; grid-template-columns: 1fr auto auto; gap: 8px; align-items: center; width: 575px; max-width: 575px; }
    .filebox .textbox { height: 32px; border: 1px solid var(--gray-300); border-radius: 6px; padding: 0 10px; background: #fafbfc; color: #8e99a8; font-size: 14px; display: flex; align-items: center; }
    .filebox input[type="file"] { display: none; }
    .info-block { display: flex; flex-direction: column; flex: 1; }
    .info-label { font-weight: 700; color: #3a4556; margin-bottom: 4px; }
    .info-value { height: 32px; border: 1px solid var(--gray-300); border-radius: 6px; padding: 0 10px; background: #fafbfc; color: var(--text); display: flex; align-items: center; font-size: 14px; }
    .date-range { display: grid; grid-template-columns: 160px 1fr; gap: 10px; align-items: center; border-bottom: 1px solid var(--gray-200); padding-bottom: 10px; margin-bottom: 10px; }
    .date-controls { display: grid; grid-template-columns: 1fr 80px 24px 1fr 80px; gap: 8px; align-items: center; width: 575px; max-width: 575px; }
    
    /* Page List Popup */
    .page-list-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 10000; }
    .page-list-popup.show { display: flex; }
    .page-list-content { background: #fff; border-radius: 8px; padding: 20px; max-width: 400px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .page-list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .page-list-title { font-size: 18px; font-weight: 700; color: var(--text-strong); }
    .page-list-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray-400); padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
    .page-list-close:hover { color: var(--text-strong); }
    .page-list-items { display: grid; gap: 8px; }
    .page-list-item { padding: 12px 16px; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer; transition: all 0.2s; background: #fff; }
    .page-list-item:hover { background: var(--gray-50); border-color: var(--primary); }
    .page-list-item.current { background: var(--primary); color: #fff; border-color: var(--primary); }
    .page-list-item-name { font-weight: 600; margin-bottom: 4px; }
    .page-list-item-desc { font-size: 12px; color: var(--gray-400); }
    .page-list-item.current .page-list-item-desc { color: rgba(255,255,255,0.8); }
    .date-controls .input, .date-controls .select { min-width: 0; width: 100%; }

    /* Badges (1.25x) */
    .badge { display: inline-flex; align-items: center; justify-content: center; width: 22px; height: 22px; border-radius: 50%; background: #e53935; color: #fff; font-weight: 700; font-size: 14px; vertical-align: middle; }
    .badge-layer { position: absolute; inset: 0; pointer-events: none; z-index: 1000; }
    .badge.draggable { position: absolute; pointer-events: auto; cursor: grab; box-shadow: 0 1px 2px rgba(0,0,0,0.2); user-select: none; }

    @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } }
  </style>
  <script>
    (function(){
      // ====== v1.1: 요소별 id 및 리스트 열 재배치 지원 ======
      var LABEL_BY_KEY = {
        no:'번호', lang:'언어', title:'제목', author:'작성자', visible:'노출여부', publishedAt:'발행일시', createdAt:'등록일시', views:'조회수'
      };
      var LABELS_BY_KEY = {
        no:['번호','No','NO','Index','인덱스'],
        lang:['언어','Language','Lang'],
        title:['제목','Title','제 목'],
        author:['작성자','Author','Writer','등록자'],
        visible:['노출여부','노출','미노출','표시','Visible','Exposure'],
        publishedAt:['발행일시','발행','게시일시','게시일','Published At','Publish Date'],
        createdAt:['등록일시','등록','생성일시','생성일','Created At','Create Date'],
        views:['조회수','View Count','Views','조회']
      };
      function buildKeyByLabel(labelsByKey){
        var map={};
        Object.keys(labelsByKey).forEach(function(k){ (labelsByKey[k]||[]).forEach(function(lbl){ map[lbl]=k; }); });
        return map;
      }
      var KEY_BY_LABEL = buildKeyByLabel(LABELS_BY_KEY);

      // Form mapping defaults (id 하나당 여러 라벨 매칭)
      var FORM_LABELS_BY_KEY = {
        lang:['언어','Language','Lang'],
        type:['유형','타입','구분','Type'],
        title:['제목','Title','제 목'],
        content:['내용','에디터','본문','Content'],
        image:['이미지','대표이미지','썸네일','썸네일 이미지','Image','Thumbnail'],
        linkUrl:['링크','링크 URL','URL','Link'],
        dateRange:['노출기간','기간','발행일시','게시일시','Publish Date','기간(시작/종료)'],
        visible:['노출여부','노출','미노출','Visible','Exposure'],
        attachment:['첨부','첨부파일','파일','Attachment']
      };
      var FORM_KEY_BY_LABEL = buildKeyByLabel(FORM_LABELS_BY_KEY);

      function $(sel){ return document.querySelector(sel); }
      function create(tag, attrs){ var el=document.createElement(tag); if(attrs){ Object.keys(attrs).forEach(function(k){ if(k==='text'){ el.textContent=attrs[k]; } else if(k==='html'){ el.innerHTML=attrs[k]; } else { el.setAttribute(k, attrs[k]); } }); } return el; }

      function applyListColumnConfig(columnKeys){
        // Build THEAD
        var thead = $('#list-thead');
        thead.innerHTML = '';
        var tr = create('tr');
        columnKeys.forEach(function(key){
          var th = create('th', { 'data-col-key': key, id: 'col-' + key, text: LABEL_BY_KEY[key] || key });
          if(key==='title'){ th.style.width='35%'; }
          tr.appendChild(th);
        });
        thead.appendChild(tr);

        // Build TBODY with 15 scaffold rows
        var tbody = $('#list-tbody');
        tbody.innerHTML = '';
        for(var i=15;i>=1;i--){
          var row = create('tr');
          columnKeys.forEach(function(key){
            var td = create('td');
            var sample = '';
            if(key==='no') sample = String(i);
            else if(key==='lang') sample = (i%4===0?'JP':i%3===0?'CN':i%2===0?'EN':'KR');
            else if(key==='title') sample = '샘플 제목 ' + i;
            else if(key==='author') sample = '운영자';
            else if(key==='visible') sample = (i%2===0?'N':'Y');
            else if(key==='publishedAt') sample = '2024-12-' + (i<10?'0'+i:i) + ' 10:00';
            else if(key==='createdAt') sample = '2024-11-30 17:30';
            td.textContent = sample;
            row.appendChild(td);
          });
          tbody.appendChild(row);
        }
      }

      // Example: from Excel labels array => keys
      function labelsToKeys(labels){
        function normalize(s){ return String(s||'').replace(/\(.+?\)/g,'').replace(/\s+/g,'').toLowerCase(); }
        // build normalized map
        var normMap={}; Object.keys(KEY_BY_LABEL).forEach(function(lbl){ normMap[normalize(lbl)]=KEY_BY_LABEL[lbl]; });
        return labels.map(function(label){ var n=normalize(label); return normMap[n] || KEY_BY_LABEL[label] || label; });
      }

      function labelsToFormKeys(labels){
        function normalize(s){ return String(s||'').replace(/\(.+?\)/g,'').replace(/\s+/g,'').toLowerCase(); }
        var normMap={}; Object.keys(FORM_KEY_BY_LABEL).forEach(function(lbl){ normMap[normalize(lbl)]=FORM_KEY_BY_LABEL[lbl]; });
        return labels.map(function(label){ var n=normalize(label); return normMap[n] || FORM_KEY_BY_LABEL[label] || label; });
      }

      // ========== CSV 자동 매핑 & 라벨 매핑 파일 지원 ==========
      function parseCsvLine(line){
        var out=[], cur='', q=false; for(var i=0;i<line.length;i++){ var ch=line[i]; if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else { q=!q; } } else if(ch===',' && !q){ out.push(cur); cur=''; } else { cur+=ch; } } out.push(cur); return out;
      }
      function parseCsv(text){
        var lines=text.replace(/^\uFEFF/, '').split(/\r?\n/).filter(Boolean); if(!lines.length) return [];
        var header=parseCsvLine(lines[0]); var rows=[]; for(var i=1;i<lines.length;i++){ var cols=parseCsvLine(lines[i]); if(cols.every(function(c){return !c;})) continue; rows.push({ header:header, cols:cols }); }
        return rows;
      }
      function extractListLabelsFromFunction(funcText){
        if(!funcText) return [];
        var lines=String(funcText).split(/\r?\n/);
        for(var i=0;i<lines.length;i++){
          var s=lines[i].trim();
          if(/^[-–]\s*리스트\s*:/.test(s) || /^리스트\s*:/.test(s)){
            var after=s.split(':').slice(1).join(':');
            return after.split(',').map(function(x){ return x.trim(); }).filter(Boolean);
          }
        }
        return [];
      }
      function extractFormLabelsFromFunction(funcText){
        if(!funcText) return [];
        var lines=String(funcText).split(/\r?\n/);
        for(var i=0;i<lines.length;i++){
          var s=lines[i].trim();
          if(/^[-–]?\s*(등록\s*화면|등록)\s*:/.test(s)){
            var after=s.split(':').slice(1).join(':');
            return after.split(',').map(function(x){ return x.trim(); }).filter(Boolean);
          }
        }
        return [];
      }
      function loadText(url){ return fetch(url).then(function(r){ if(!r.ok) throw new Error('fail '+url); return r.text(); }); }
      function loadJson(url){ return fetch(url).then(function(r){ if(!r.ok) throw new Error('fail '+url); return r.json(); }); }
      function autoApplyFromCsvAndMapping(opts){
        opts=opts||{}; var csvPath=opts.csvPath||'sheet1.csv'; var mapPath=opts.mapPath||'label-mapping.txt'; var wantMenu1=opts.menu1; var wantMenu2=opts.menu2;
        // 1) load mapping and rebuild KEY_BY_LABEL (list)
        return loadJson(mapPath).then(function(mapping){
          var listMap = mapping.list || mapping; LABELS_BY_KEY=listMap; KEY_BY_LABEL=buildKeyByLabel(LABELS_BY_KEY);
        })
        .catch(function(){ /* keep defaults */ })
        .then(function(){ return loadText(csvPath); })
        .then(function(csv){ var rows=parseCsv(csv); if(!rows.length) throw new Error('CSV empty');
          // find first 목록 row (optionally filter by 메뉴1/메뉴2)
          var chosen=null; for(var i=0;i<rows.length;i++){ var header=rows[i].header, cols=rows[i].cols; var idx1=header.indexOf('메뉴1'); var idx2=header.indexOf('메뉴2'); var idx3=header.indexOf('메뉴3'); var idxF=header.indexOf('기능'); if(idx1<0||idx2<0||idx3<0||idxF<0){ idx1=0; idx2=1; idx3=2; idxF=3; }
            var m1=cols[idx1]||''; var m2=cols[idx2]||''; var m3=cols[idx3]||''; if(wantMenu1 && m1!==wantMenu1) continue; if(wantMenu2 && m2!==wantMenu2) continue; if(m3.indexOf('목록')>-1){ chosen=cols; break; } }
          if(!chosen) throw new Error('목록 항목을 찾지 못했습니다.');
          var header=rows[0].header; var idxF=header.indexOf('기능'); if(idxF<0) idxF=3; var func=chosen[idxF]||''; var labels=extractListLabelsFromFunction(func);
          var keys=labelsToKeys(labels);
          applyListColumnConfig(keys);
        }).catch(function(err){ console.warn('자동 매핑 실패:', err); });
      }

      function applyFormConfig(formKeys){
        if(!Array.isArray(formKeys) || !formKeys.length) return;
        var map = {
          lang:'post-row-lang', type:'post-row-type', title:'post-row-title', content:'post-row-content',
          image:'post-row-image', linkUrl:'post-row-link',
          dateRange:'post-row-daterange', visible:'post-row-visible', attachment:'post-row-attachment'
        };
        // Hide all first
        Object.keys(map).forEach(function(k){ var el=document.getElementById(map[k]); if(el){ el.style.display='none'; } });
        // Reorder and show as given order
        var form = document.getElementById('post-form');
        formKeys.forEach(function(k){ var id=map[k]; var el=id && document.getElementById(id); if(el){ el.style.display='grid'; form.appendChild(el); } });
      }

      function autoApplyFormFromCsvAndMapping(opts){
        opts=opts||{}; var csvPath=opts.csvPath||'sheet1.csv'; var mapPath=opts.mapPath||'label-mapping.txt'; var wantMenu1=opts.menu1; var wantMenu2=opts.menu2;
        return loadJson(mapPath).then(function(mapping){
          if(mapping.form){ FORM_LABELS_BY_KEY=mapping.form; FORM_KEY_BY_LABEL=buildKeyByLabel(FORM_LABELS_BY_KEY); }
        }).catch(function(){ /* keep defaults */ })
        .then(function(){ return loadText(csvPath); })
        .then(function(csv){ var rows=parseCsv(csv); if(!rows.length) throw new Error('CSV empty');
          // find first 등록 row (optionally filter), fallback to 수정/상세
          var chosen=null; for(var i=0;i<rows.length;i++){ var header=rows[i].header, cols=rows[i].cols; var idx1=header.indexOf('메뉴1'); var idx2=header.indexOf('메뉴2'); var idx3=header.indexOf('메뉴3'); var idxF=header.indexOf('기능'); if(idx1<0||idx2<0||idx3<0||idxF<0){ idx1=0; idx2=1; idx3=2; idxF=3; }
            var m1=cols[idx1]||''; var m2=cols[idx2]||''; var m3=cols[idx3]||''; if(wantMenu1 && m1!==wantMenu1) continue; if(wantMenu2 && m2!==wantMenu2) continue; if(m3.indexOf('등록')>-1){ chosen=cols; break; } }
          if(!chosen){ for(var j=0;j<rows.length && !chosen;j++){ var h=rows[j].header, c=rows[j].cols; var i1=h.indexOf('메뉴1'); var i2=h.indexOf('메뉴2'); var i3=h.indexOf('메뉴3'); var iF=h.indexOf('기능'); if(i1<0||i2<0||i3<0||iF<0){ i1=0;i2=1;i3=2;iF=3; }
            var mm1=c[i1]||'', mm2=c[i2]||'', mm3=c[i3]||''; if(wantMenu1 && mm1!==wantMenu1) continue; if(wantMenu2 && mm2!==wantMenu2) continue; if(/수정|상세/.test(mm3)){ chosen=c; break; } }
          }
          if(!chosen) throw new Error('등록/상세 항목을 찾지 못했습니다.');
          var header=rows[0].header; var idxF=header.indexOf('기능'); if(idxF<0) idxF=3; var func=chosen[idxF]||''; var labels=extractFormLabelsFromFunction(func);
          var keys=labelsToFormKeys(labels);
          applyFormConfig(keys);
        }).catch(function(err){ console.warn('등록 자동 매핑 실패:', err); });
      }

      // Badges
      function getBadgeCountFromDescription(){ return document.querySelectorAll('#desc-list .desc-item .head').length || 0; }
      function loadPositions(count){
        try{ var arr = JSON.parse(localStorage.getItem('badgePositions')||'[]'); if(!Array.isArray(arr)) arr=[]; while(arr.length<count) arr.push({x:16+arr.length*26,y:16}); return arr.slice(0,count);}catch(e){ return Array.from({length:count},(_,i)=>({x:16+i*26,y:16})); }
      }
      function savePositions(p){ try{ localStorage.setItem('badgePositions', JSON.stringify(p)); }catch(e){} }
      function makeDraggable(el, pos, i){
        var sx=0, sy=0, ox=0, oy=0, mv=false;
        function down(e){ mv=true; el.style.cursor='grabbing'; sx=(e.touches?e.touches[0].clientX:e.clientX); sy=(e.touches?e.touches[0].clientY:e.clientY); ox=parseFloat(el.style.left)||0; oy=parseFloat(el.style.top)||0; document.addEventListener('mousemove', move); document.addEventListener('mouseup', up); document.addEventListener('touchmove', move,{passive:false}); document.addEventListener('touchend', up); }
        function move(e){ if(!mv) return; if(e.touches) e.preventDefault(); var cx=(e.touches?e.touches[0].clientX:e.clientX), cy=(e.touches?e.touches[0].clientY:e.clientY); var nx=ox+(cx-sx), ny=oy+(cy-sy); var maxX=window.innerWidth-el.offsetWidth-2, maxY=window.innerHeight-el.offsetHeight-2; nx=Math.max(2,Math.min(maxX,nx)); ny=Math.max(2,Math.min(maxY,ny)); el.style.left=nx+'px'; el.style.top=ny+'px'; }
        function up(){ if(!mv) return; mv=false; el.style.cursor='grab'; pos[i]={x:parseFloat(el.style.left)||0,y:parseFloat(el.style.top)||0}; savePositions(pos); document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); document.removeEventListener('touchmove', move); document.removeEventListener('touchend', up); }
        el.addEventListener('mousedown', down); el.addEventListener('touchstart', down, {passive:true});
      }
      function renderBadges(){
        var c=getBadgeCountFromDescription(), p=loadPositions(c), layer=document.querySelector('.badge-layer')||document.body.appendChild(Object.assign(document.createElement('div'),{className:'badge-layer'}));
        layer.innerHTML='';
        for(var i=0;i<c;i++){
          var b=document.createElement('div'); b.className='badge draggable'; b.textContent=(i+1);
          b.style.left=(p[i].x||16)+'px'; b.style.top=(p[i].y||16)+'px';
          layer.appendChild(b); makeDraggable(b,p,i);
        }
      }

      function switchTab(tab){
        document.querySelectorAll('.tab-btn').forEach(function(b){ b.classList.toggle('active', b.dataset.tab===tab); });
        document.querySelectorAll('.panel').forEach(function(p){ p.classList.toggle('active', p.id===tab); });
        renderBadges();
      }

      window.addEventListener('DOMContentLoaded', function(){
        // Sync meta path
        var _stl = document.getElementById('section-title-list');
        var listTitle = _stl ? _stl.textContent : '';
        var metaPath = document.getElementById('meta-path'); if(metaPath) metaPath.textContent=listTitle;

        // Default columns (15행 스캐폴드 및 35% 제목 폭)
        applyListColumnConfig(['no','lang','title','author','visible','publishedAt','createdAt']);

        // Tab handlers
        var _btnList = document.getElementById('tab-list-btn'); if(_btnList){ _btnList.addEventListener('click', function(){ switchTab('panel-list'); }); }
        var _btnPost = document.getElementById('tab-post-btn'); if(_btnPost){ _btnPost.addEventListener('click', function(){ switchTab('panel-post'); }); }
        var _btnDetail = document.getElementById('tab-detail-btn'); if(_btnDetail){ _btnDetail.addEventListener('click', function(){ switchTab('panel-detail'); }); }

        // Page List functionality
        var pageListPopup = document.getElementById('page-list-popup');
        var pageListClose = document.getElementById('page-list-close');
        var pageListItems = document.getElementById('page-list-items');
        
        // 페이지 목록 데이터
        var pageList = [
          { name: 'Media관리 > News > 목록', file: 'Media관리_News_목록.html', desc: '뉴스 게시글 목록 관리' },
          { name: 'Media관리 > News > 등록', file: 'Media관리_News_등록.html', desc: '뉴스 게시글 등록' },
          { name: 'Media관리 > News > 수정/상세', file: 'Media관리_News_수정_상세.html', desc: '뉴스 게시글 수정/상세' },
          { name: 'Media관리 > Social > 목록', file: 'Media관리_Social_목록.html', desc: '소셜 포스트 목록 관리' },
          { name: 'Media관리 > Social > 등록', file: 'Media관리_Social_등록.html', desc: '소셜 포스트 등록' },
          { name: 'Media관리 > Social > 수정/상세', file: 'Media관리_Social_수정_상세.html', desc: '소셜 포스트 수정/상세' }
        ];
        
        function getCurrentPage() {
          var path = window.location.pathname;
          var filename = path.split('/').pop();
          return filename || 'admin-template-v1.1.html';
        }
        
        function renderPageList() {
          var currentPage = getCurrentPage();
          pageListItems.innerHTML = '';
          
          pageList.forEach(function(page) {
            var item = document.createElement('div');
            item.className = 'page-list-item';
            if (page.file === currentPage) {
              item.classList.add('current');
            }
            
            item.innerHTML = '<div class="page-list-item-name">' + page.name + '</div><div class="page-list-item-desc">' + page.desc + '</div>';
            
            item.addEventListener('click', function() {
              if (page.file !== currentPage) {
                window.location.href = page.file;
              }
            });
            
            pageListItems.appendChild(item);
          });
        }
        
        function showPageList() {
          renderPageList();
          pageListPopup.classList.add('show');
        }
        
        function hidePageList() {
          pageListPopup.classList.remove('show');
        }
        
        // 이벤트 리스너
        var pageListBtns = document.querySelectorAll('[id^="page-list-btn"]');
        pageListBtns.forEach(function(btn) {
          btn.addEventListener('click', showPageList);
        });
        
        if (pageListClose) {
          pageListClose.addEventListener('click', hidePageList);
        }
        
        if (pageListPopup) {
          pageListPopup.addEventListener('click', function(e) {
            if (e.target === pageListPopup) {
              hidePageList();
            }
          });
        }
        switchTab('panel-list');

        // Expose API globally for Excel → Template 매핑
        window.AdminTemplateV11 = {
          applyListColumnConfig: applyListColumnConfig,
          labelsToKeys: labelsToKeys,
          labelsToFormKeys: labelsToFormKeys,
          LABEL_BY_KEY: LABEL_BY_KEY,
          KEY_BY_LABEL: KEY_BY_LABEL,
          autoApplyFromCsvAndMapping: autoApplyFromCsvAndMapping,
          autoApplyFormFromCsvAndMapping: autoApplyFormFromCsvAndMapping,
          applyFormConfig: applyFormConfig
        };

        // Auto map button
        var autoBtn = document.getElementById('btn-auto-map');
        if(autoBtn){
          autoBtn.addEventListener('click', function(){
            try{
              var m1=document.getElementById('auto-menu1'); m1=m1?m1.value:'';
              var m2=document.getElementById('auto-menu2'); m2=m2?m2.value:'';
              var st=document.getElementById('auto-map-status'); if(st){ st.textContent='매핑 중…'; }
              window.AdminTemplateV11.autoApplyFromCsvAndMapping({ csvPath:'sheet1.csv', mapPath:'label-mapping.txt', menu1:m1, menu2:m2 })
                .then(function(){ if(st){ st.textContent='완료'; setTimeout(function(){ st.textContent=''; }, 1500); } })
                .catch(function(e){ if(st){ st.textContent='오류: '+e; } });
            }catch(e){ var st=document.getElementById('auto-map-status'); if(st){ st.textContent='오류: '+e; } }
          });
        }
        var autoFormBtn = document.getElementById('btn-auto-map-form');
        if(autoFormBtn){
          autoFormBtn.addEventListener('click', function(){
            try{
              var m1=document.getElementById('auto-menu1-post'); m1=m1?m1.value:'';
              var m2=document.getElementById('auto-menu2-post'); m2=m2?m2.value:'';
              var st=document.getElementById('auto-map-status-post'); if(st){ st.textContent='매핑 중…'; }
              window.AdminTemplateV11.autoApplyFormFromCsvAndMapping({ csvPath:'sheet1.csv', mapPath:'label-mapping.txt', menu1:m1, menu2:m2 })
                .then(function(){ if(st){ st.textContent='완료'; setTimeout(function(){ st.textContent=''; }, 1500); } })
                .catch(function(e){ if(st){ st.textContent='오류: '+e; } });
            }catch(e){ var st=document.getElementById('auto-map-status-post'); if(st){ st.textContent='오류: '+e; } }
          });
        }
      });
    })();
  </script>
</head>
<body>
  <div class="container" id="tpl-container">
    <div class="tabbar" id="tpl-tabbar">
      <button class="tab-btn" id="tab-list-btn" data-tab="panel-list">목록</button>
      <button class="tab-btn" id="tab-post-btn" data-tab="panel-post">등록</button>
      <button class="tab-btn" id="tab-detail-btn" data-tab="panel-detail">수정/상세</button>
    </div>

    <!-- 목록 패널 -->
    <div id="panel-list" class="panel active" aria-labelledby="tab-list-btn">
      <div class="meta card" id="meta-card">
        <div class="meta-title" id="meta-title">관리자 페이지 제목</div>
        <div class="meta-chip" id="meta-chip-path">Path</div>
        <div class="meta-value" id="meta-path"></div>
        <div class="meta-chip" id="meta-chip-writer">Writer</div>
        <div class="meta-value" id="meta-writer">Your Team</div>
        <div class="meta-chip" id="meta-chip-date">Date / Version</div>
        <div class="meta-value small" id="meta-date">2025</div>
        <div class="meta-chip small" id="meta-chip-page">page</div>
        <div class="meta-value small" id="meta-page">1</div>
      </div>

      <div class="section-title" id="section-title">
        <div id="section-title-list">섹션 > 하위섹션 > 목록</div>
        <div class="nav" id="nav-list"><a class="button" href="#">이전</a><a class="button" href="#">다음</a><button class="button" id="page-list-btn" type="button">페이지 목록</button></div>
      </div>

      <div class="layout" id="layout-list">
        <div class="card" id="list-card">
          <div class="nav" id="auto-map-tools" style="margin-bottom:8px">
            <input class="input" id="auto-menu1" placeholder="메뉴1 (예: Media관리)" value="Media관리" />
            <input class="input" id="auto-menu2" placeholder="메뉴2 (예: News)" value="News" />
            <button class="button" id="btn-auto-map" type="button">CSV 자동 매핑</button>
            <span id="auto-map-status" style="color:#8e99a8"></span>
          </div>
          <div class="filters" id="filters">
            <div class="date-controls" id="filter-date">
              <input type="date" class="input" id="filter-start-date" aria-label="시작일" />
              <select class="select" id="filter-start-hour" aria-label="시작 시각"><option>00시</option><option>06시</option><option>12시</option><option>18시</option></select>
              <div class="separator" id="filter-sep">~</div>
              <input type="date" class="input" id="filter-end-date" aria-label="종료일" />
              <select class="select" id="filter-end-hour" aria-label="종료 시각"><option>00시</option><option>06시</option><option>12시</option><option>18시</option></select>
            </div>
            <select class="select" id="filter-cond" aria-label="검색 조건">
              <option>전체</option>
              <option>제목</option>
              <option>내용</option>
            </select>
            <input class="input" id="filter-keyword" type="text" placeholder="검색" />
            <button class="button primary" id="filter-submit" type="button">검색</button>
          </div>

          <table role="table" aria-label="목록 테이블" id="list-table">
            <thead id="list-thead"></thead>
            <tbody id="list-tbody"></tbody>
          </table>

          <div class="actions" id="list-actions">
            <button class="btn-register" id="btn-register" type="button">등록</button>
            <nav class="pagination" id="pagination" aria-label="페이지네이션">
              <button class="page-btn" aria-label="처음">««</button>
              <button class="page-btn" aria-label="이전">«</button>
              <button class="page-btn active" aria-current="page">1</button>
              <button class="page-btn">2</button>
              <button class="page-btn">3</button>
              <button class="page-btn" aria-label="다음">»</button>
              <button class="page-btn" aria-label="마지막">»»</button>
            </nav>
          </div>
        </div>

        <aside class="aside card" id="desc-aside" aria-label="Description">
          <div class="title" id="desc-title">Description</div>
          <div class="desc-list" id="desc-list">
            <div class="desc-item" id="desc-item-1"><div class="head">1. 언어</div><ul><li>KR, EN, CN, JP</li></ul></div>
            <div class="desc-item" id="desc-item-2"><div class="head">2. 검색 조건</div><ul><li>전체, 제목</li></ul></div>
            <div class="desc-item" id="desc-item-3"><div class="head">3. 제목</div><ul><li>클릭 시 상세/수정 이동</li></ul></div>
            <div class="desc-item" id="desc-item-4"><div class="head">4. 등록</div><ul><li>등록 화면 이동</li></ul></div>
          </div>
        </aside>
      </div>
    </div>

    <!-- 등록 패널 -->
    <div id="panel-post" class="panel" aria-labelledby="tab-post-btn">
      <div class="meta card" id="meta-card-post">
        <div class="meta-title" id="meta-title-post">관리자 페이지 제목</div>
        <div class="meta-chip">Path</div>
        <div class="meta-value" id="meta-path-post"></div>
        <div class="meta-chip">Writer</div>
        <div class="meta-value" id="meta-writer-post">Your Team</div>
        <div class="meta-chip">Date / Version</div>
        <div class="meta-value small" id="meta-date-post">2025</div>
        <div class="meta-chip small">page</div>
        <div class="meta-value small" id="meta-page-post">1</div>
      </div>

      <div class="section-title" id="section-title-post">
        <div>섹션 > 하위섹션 > 등록</div>
        <div class="nav" id="nav-post"><a class="button" href="#">이전</a><a class="button" href="#">다음</a><button class="button" id="page-list-btn-post" type="button">페이지 목록</button></div>
      </div>

      <div class="layout" id="layout-post">
        <div class="card" id="post-card">
          <div class="nav" id="auto-map-tools-post" style="margin-bottom:8px">
            <input class="input" id="auto-menu1-post" placeholder="메뉴1 (예: Media관리)" value="Media관리" />
            <input class="input" id="auto-menu2-post" placeholder="메뉴2 (예: News)" value="News" />
            <button class="button" id="btn-auto-map-form" type="button">CSV 자동 매핑(등록)</button>
            <span id="auto-map-status-post" style="color:#8e99a8"></span>
          </div>
          <form class="form" id="post-form" onsubmit="return false;" aria-label="등록 폼 템플릿">
            <div class="row" id="post-row-lang">
              <div class="label" id="post-label-lang">언어</div>
              <div class="radio-group" id="post-lang">
                <label><input type="radio" name="lang" value="KR" checked> KR</label>
                <label><input type="radio" name="lang" value="EN"> EN</label>
                <label><input type="radio" name="lang" value="CN"> CN</label>
                <label><input type="radio" name="lang" value="JP"> JP</label>
              </div>
            </div>

            <div class="row" id="post-row-type">
              <div class="label" id="post-label-type">유형 <span class="req">*</span></div>
              <div>
                <select class="select w-575" id="post-type" aria-label="유형">
                  <option>이미지</option>
                  <option>텍스트</option>
                  <option>이미지+텍스트</option>
                </select>
              </div>
            </div>

            <div class="row" id="post-row-title">
              <div class="label" id="post-label-title">제목 <span class="req">*</span></div>
              <div><input type="text" class="input w-575" id="post-title" placeholder="제목을 입력해주세요." aria-label="제목" /></div>
            </div>

            <div class="row" id="post-row-image">
              <div class="label" id="post-label-image">이미지 <span class="req">*</span></div>
              <div class="control" id="post-image">
                <div class="filebox">
                  <div class="textbox">선택된 파일이 없습니다.</div>
                  <button class="button" type="button">파일 선택</button>
                  <button class="button" type="button">삭제</button>
                </div>
                <div class="hint" id="post-image-hint">※ 권장 사이즈: 가로 ###px * 세로 ###px<br>파일 형식: JPG, JPEG, PNG / 용량: 30MB 이하</div>
              </div>
            </div>

            <div class="row" id="post-row-attachment">
              <div class="label" id="post-label-attachment">첨부파일</div>
              <div class="control" id="post-attachment">
                <div class="filebox">
                  <div class="textbox">선택된 파일이 없습니다.</div>
                  <button class="button" type="button">파일 선택</button>
                  <button class="button" type="button">삭제</button>
                </div>
                <div class="hint" id="post-attachment-hint">※ 파일 형식: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX / 용량: 50MB 이하</div>
              </div>
            </div>

            <div class="row" id="post-row-link">
              <div class="label" id="post-label-link">링크 URL</div>
              <div style="display:flex; flex-direction:column; gap:8px; align-items:stretch;">
                <div class="radio-group" id="post-link-target">
                  <label><input type="radio" name="target" value="_self" checked> 본창</label>
                  <label><input type="radio" name="target" value="_blank"> 새창</label>
                </div>
                <input type="text" class="input w-575" id="post-link" placeholder="https://" aria-label="링크 URL" />
              </div>
            </div>

            <div class="date-range" id="post-row-daterange">
              <div class="label" id="post-label-daterange" style="font-weight:700;">노출기간 <span class="req">*</span></div>
              <div class="date-controls" id="post-daterange-controls">
                <input type="date" class="input" id="post-start-date" aria-label="시작일" />
                <select class="select" id="post-start-hour" aria-label="시작 시각"><option>00시</option><option>06시</option><option>12시</option><option>18시</option></select>
                <div class="separator" id="post-daterange-sep">~</div>
                <input type="date" class="input" id="post-end-date" aria-label="종료일" />
                <select class="select" id="post-end-hour" aria-label="종료 시각"><option>00시</option><option>06시</option><option>12시</option><option>18시</option></select>
              </div>
            </div>

            <div class="row" id="post-row-visible">
              <div class="label" id="post-label-visible" style="font-weight:700;">노출여부 <span class="req">*</span></div>
              <div class="radio-group" id="post-visible"><label><input type="radio" name="visible" value="Y" checked> Y</label><label><input type="radio" name="visible" value="N"> N</label></div>
            </div>

            <div class="actions" id="post-actions" style="justify-content:flex-end;">
              <button class="button" id="post-btn-list" type="button">목록</button>
              <button class="button primary" id="post-btn-submit" type="submit">등록</button>
            </div>
          </form>
        </div>

        <aside class="aside card" id="desc-aside-post" aria-label="Description">
          <div class="title" id="desc-title-post">Description</div>
          <div class="desc-list" id="desc-list-post">
            <div class="desc-item" id="desc-post-1"><div class="head">1. 유형</div><ul><li>이미지, 텍스트, 이미지+텍스트</li></ul></div>
            <div class="desc-item" id="desc-post-2"><div class="head">2. 팝업 이미지/텍스트</div><ul><li>PC/Mobile 업로드 또는 텍스트 입력</li></ul></div>
            <div class="desc-item" id="desc-post-3"><div class="head">3. 노출기간</div><ul><li>00시~24시 선택 가능</li></ul></div>
            <div class="desc-item" id="desc-post-4"><div class="head">4. 등록/목록</div><ul><li>등록/목록 버튼 동작</li></ul></div>
          </div>
        </aside>
      </div>
    </div>

    <!-- 수정/상세 패널 -->
    <div id="panel-detail" class="panel" aria-labelledby="tab-detail-btn">
      <div class="meta card" id="meta-card-detail">
        <div class="meta-title" id="meta-title-detail">관리자 페이지 제목</div>
        <div class="meta-chip">Path</div>
        <div class="meta-value" id="meta-path-detail"></div>
        <div class="meta-chip">Writer</div>
        <div class="meta-value" id="meta-writer-detail">Your Team</div>
        <div class="meta-chip">Date / Version</div>
        <div class="meta-value small" id="meta-date-detail">2025</div>
        <div class="meta-chip small">page</div>
        <div class="meta-value small" id="meta-page-detail">1</div>
      </div>

      <div class="section-title" id="section-title-detail">
        <div>섹션 > 하위섹션 > 수정/상세</div>
        <div class="nav" id="nav-detail"><a class="button" href="#">이전</a><a class="button" href="#">다음</a><button class="button" id="page-list-btn-detail" type="button">페이지 목록</button></div>
      </div>

      <div class="layout" id="layout-detail">
        <div class="card" id="detail-card">
          <div class="form" id="detail-form" aria-label="수정/상세 폼 템플릿">
            <div class="row" id="detail-row-registration">
              <div class="info-block">
                <div class="info-label" id="detail-label-registeredBy">등록자</div>
                <div class="info-value" id="detail-registeredBy">김하나</div>
              </div>
              <div class="info-block">
                <div class="info-label" id="detail-label-registeredAt">등록일시</div>
                <div class="info-value" id="detail-registeredAt">2024-05-19 17:30</div>
              </div>
            </div>
            <div class="row" id="detail-row-modification">
              <div class="info-block">
                <div class="info-label" id="detail-label-updatedBy">수정자</div>
                <div class="info-value" id="detail-updatedBy">홍길동</div>
              </div>
              <div class="info-block">
                <div class="info-label" id="detail-label-updatedAt">수정일시</div>
                <div class="info-value" id="detail-updatedAt">2024-06-19 18:30</div>
              </div>
            </div>
            <div class="actions" id="detail-actions" style="justify-content:flex-end;">
              <button class="button primary" id="detail-btn-update" type="button">수정하기</button>
              <button class="button" id="detail-btn-delete" type="button">삭제하기</button>
              <button class="button" id="detail-btn-list" type="button">목록으로</button>
            </div>
          </div>
        </div>

        <aside class="aside card" id="desc-aside-detail" aria-label="Description">
          <div class="title" id="desc-title-detail">Description</div>
          <div class="desc-list" id="desc-list-detail">
            <div class="desc-item" id="desc-detail-1"><div class="head">1. 이력</div><ul><li>등록자/등록일시, 수정자/수정일시</li></ul></div>
            <div class="desc-item" id="desc-detail-2"><div class="head">2. 버튼</div><ul><li>수정하기, 삭제하기, 목록으로</li></ul></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Page List Popup -->
  <div class="page-list-popup" id="page-list-popup">
    <div class="page-list-content">
      <div class="page-list-header">
        <div class="page-list-title">페이지 목록</div>
        <button class="page-list-close" id="page-list-close">&times;</button>
      </div>
      <div class="page-list-items" id="page-list-items">
        <!-- 페이지 목록이 동적으로 생성됩니다 -->
      </div>
    </div>
  </div>
</body>
</html>


